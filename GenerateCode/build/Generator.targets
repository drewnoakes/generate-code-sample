<Project>

  <Target Name="GenerateFileHashOutputFiles" BeforeTargets="CoreCompile">

    <GetFileHash Files="@(GeneratorInput)">
      <Output TaskParameter="Items" ItemName="FilesWithHashes" />
    </GetFileHash>

    <ItemGroup>
      <GeneratorSourceFile Include="FilesWithHashes">
        <GeneratedOutputPath>@(FilesWithHashes -> '$(IntermediateOutputPath)$([System.IO.Path]::GetFileNameWithoutExtension('%(Identity)')).cs')</GeneratedOutputPath>
        <Source>
namespace GenerateCode%3b

// This file is generated by $([System.IO.Path]::GetFileName('$(MSBuildThisFile)'))

internal static class $([System.IO.Path]::GetFileNameWithoutExtension('%(Identity)'))
{
    public static readonly string Hash = "@(FilesWithHashes -> '%(FileHash)')"%3b
}
        </Source>
      </GeneratorSourceFile>
    </ItemGroup>

    <WriteLinesToFile
      File="%(GeneratorSourceFile.GeneratedOutputPath)"
      Lines="%(GeneratorSourceFile.Source)"
      WriteOnlyWhenDifferent="true"
      Overwrite="true"
      />

  </Target>
  
</Project>
